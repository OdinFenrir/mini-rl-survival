// ...existing code from viz.py...